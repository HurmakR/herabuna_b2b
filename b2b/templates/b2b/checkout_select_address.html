{% extends "b2b/base.html" %}
{% block title %}Підтвердження замовлення — Herabuna B2B{% endblock %}
{% block content %}
<h2 class="h4 mb-3">Підтвердження замовлення</h2>

<form method="post" action="{% url 'b2b:order_checkout_confirm' %}" class="card p-3 mb-3">
  {% csrf_token %}
  <label class="form-label">Оберіть адресу доставки (Нова Пошта)</label>
  <select name="address_id" class="form-select mb-3" required>
    {% for a in addresses %}
      <option value="{{ a.id }}">{{ a.title }} — {{ a.city_name }}, {{ a.warehouse_name }}</option>
    {% endfor %}
  </select>
  <div class="d-flex gap-2">
    <a class="btn btn-outline-secondary" href="{% url 'b2b:cart' %}">Повернутись до замовлення</a>
    <button class="btn btn-primary">Підтвердити</button>
  </div>
</form>

<div class="table-responsive">
  <table class="table table-striped table-bordered align-middle">
    <thead class="table-light">
      <tr>
        <th>Фото</th><th>SKU</th><th>Назва</th><th class="text-end">К-сть</th><th class="text-end">Ціна</th><th class="text-end">Сума</th>
      </tr>
    </thead>
    <tbody>
      {% for i in order.items.all %}
      <tr>
        <td style="width:90px">
          {% with img=i.variant.image_url|default:i.product.main_image_url %}
            {% if img %}<img src="{{ img }}" alt="" style="height:70px; object-fit:contain">{% endif %}
          {% endwith %}
        </td>
        <td>{{ i.product.sku }}</td>
        <td>{% if i.variant %}{{ i.variant.name_with_weight }}{% else %}{{ i.product.name_with_weight }}{% endif %}</td>
        <td class="text-end">{{ i.qty }}</td>
        <td class="text-end">{{ i.price }}</td>
        <td class="text-end">{{ i.line_total }}</td>
      </tr>
      {% endfor %}
      <tr>
        <td colspan="5" class="text-end fw-semibold">Разом:</td>
        <td class="text-end fw-bold">{{ order.total }}</td>
      </tr>
    </tbody>
  </table>
</div>
{% endblock %}
