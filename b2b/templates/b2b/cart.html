{% extends "b2b/base.html" %}
{% block title %}Кошик — Herabuna B2B{% endblock %}
{% block content %}
<h2 class="h4 mb-3">Кошик</h2>

{% if order and order.items.all %}
  <div class="table-responsive">
    <table class="table table-striped table-bordered align-middle">
      <thead class="table-light">
        <tr>
          <th>Фото</th>
          <th>SKU</th>
          <th>Товар</th>
          <th class="text-end">К-сть</th>
          <th class="text-end">Ціна</th>
          <th class="text-end">Сума</th>
          <th></th>
        </tr>
      </thead>
      <tbody>
        {% for i in order.items.all %}
        <tr>
          <td style="width:90px">
            {% with img=i.variant.image_url|default:i.product.main_image_url %}
              {% if img %}<img src="{{ img }}" alt="" style="height:70px; object-fit:contain">{% endif %}
            {% endwith %}
          </td>
          <td>{{ i.product.sku }}</td>
          <td>{% if i.variant %}{{ i.variant.name_with_weight }}{% else %}{{ i.product.name_with_weight }}{% endif %}</td>
          <td class="text-end">
            <form method="post" action="{% url 'b2b:cart_update_item' i.id %}" class="d-inline-flex align-items-center gap-1" data-stepper>
              {% csrf_token %}
              <button class="btn btn-outline-secondary btn-sm" type="button" data-stepper-btn="minus">−</button>
              <input class="form-control form-control-sm text-center" type="number" name="qty" value="{{ i.qty }}" min="1" max="{{ i.max_qty }}" step="1" style="width:80px">
              <button class="btn btn-outline-secondary btn-sm" type="button" data-stepper-btn="plus">+</button>
              <button class="btn btn-outline-primary btn-sm ms-2" type="submit">Ок</button>
            </form>
          </td>
          <td class="text-end">{{ i.price }}</td>
          <td class="text-end">{{ i.line_total }}</td>
          <td class="text-end">
            <form method="post" action="{% url 'b2b:cart_remove_item' i.id %}" onsubmit="return confirm('Видалити позицію?')">
              {% csrf_token %}
              <button class="btn btn-outline-danger btn-sm">×</button>
            </form>
          </td>
        </tr>
        {% endfor %}
        <tr>
          <td colspan="5" class="text-end fw-semibold">Разом:</td>
          <td class="text-end fw-bold">{{ order.total }}</td>
          <td></td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="d-flex flex-wrap gap-2">
    <a class="btn btn-primary" href="{% url 'b2b:order_checkout' %}">Підтвердити</a>
    <form method="post" action="{% url 'b2b:cart_clear' %}" onsubmit="return confirm('Очистити кошик?')">
      {% csrf_token %}
      <button class="btn btn-outline-danger">Очистити кошик</button>
    </form>
    <a class="btn btn-outline-secondary" href="{% url 'b2b:product_list' %}">Продовжити покупки</a>
  </div>
{% else %}
  <div class="alert alert-info">Кошик порожній.</div>
{% endif %}
{% endblock %}
